version: 2

sources:
  - name: tpch
    description: copy of a postgres application database
    database: raw
    schema: tpch_sf001
    tables:
      - name: customer
        description: raw customer data
        columns:
          - name: c_custkey
            description: primary key for customers
            tests:
              - unique
              - not_null
        
      # create surrogate key on top of this raw dataset
      - name: lineitem
        description: order line item data
        columns:
          - name: l_orderkey
            description: foreign key to parent order of the line item
            tests: 
              - relationships:
                  to: source('tpch_001', 'orders')
                  field: o_orderkey
          
          - name: l_partkey
            description: foreign key to part ordered on the line item
            tests:
              - relationships:
                  to: source('tpch_001', 'part')
                  field: p_partkey

      - name: nation
        description: national geographic dimensions table
        columns:
          - name: n_nationkey
            description: primary key for nations table
            tests:
              - unique
              - not_null
          - name: n_regionkey
            description: foreign key to region table
            tests:
              - unique
              - not_null
      
      - name: orders
        description: raw orders data
        columns: 
          - name: o_orderkey
            description: primary key for orders
            tests:
              - unique
              - not_null
      
      - name: part
        description: raw parts data
        columns:
          - name: p_partkey
            description: primary key for parts
            tests:
              - unique
              - not_null
      
      - name: partsupp
        description: bridge table between suppliers and parts
        columns:
          - name: ps_partkey
            description: foreign key to parts table
            tests:
              - relationships:
                  to: source('tphc_sf001', 'part')
                  field: p_partkey
          - name: ps_suppkey
            description: foreign key to supplier table
            tests:
              - relationships:
                  to: source('tphc_sf001', 'supplier')
                  field: s_suppkey
      
      - name: region
        description: raw region data
        columns:
          - name: r_regionkey
            description: primary key for regions
            tests:
              - unique
              - not_null
      
      - name: supplier
        description: raw suppliers data
        columns: 
          - name: s_suppkey
            description: primary key for suppliers
            tests:
              - unique
              - not_null